# ğŸ”’ Sprint 10 Backlog: SOC2 Audit & Immutable Ledger

**Sprint Goal:** Implement a cryptographically secure audit trail for all AI-driven decisions to ensure 100% transparency and non-repudiation for institutional auditors.

---

## ğŸ—ï¸ Story 9.1: Cryptographic Transaction Hashing
**User Persona:** As a Compliance Officer, I want every AI-matched transaction to have a unique digital fingerprint so that I can verify the data hasn't been tampered with after the fact.

### ğŸ“ Description
Develop a hashing utility using the `hashlib` library. Every time the `SmartMatchingEngine` confirms a match (Auto or Manual), a SHA-256 hash must be generated by combining the `Invoice_ID`, `Bank_Ref`, `Amount`, and `Timestamp`.

### âœ… Acceptance Criteria
- [ ] **Hash Generation:** System successfully generates a 64-character hex string for every ledger entry.
- [ ] **Data Integrity:** Any change to a historical record in the `Audit Ledger` must cause a "Hash Mismatch" warning.
- [ ] **Metadata:** The hash must include the `Engine_Version` used to identify which algorithm made the match.



---

## ğŸ—ï¸ Story 9.2: The "Explainable AI" (XAI) Audit View
**User Persona:** As an External Auditor, I want to see *why* the AI suggested a fuzzy match so that I can validate the logic behind high-value reconciliations.

### ğŸ“ Description
Enhance the **Audit Ledger** UI to include a "Logic Breakdown" modal. This view should display the specific Levenshtein distance scores and token ratios used by the matching engine for that specific transaction.

### âœ… Acceptance Criteria
- [ ] **Logic Transparency:** UI displays the raw similarity score (e.g., "92% Match on Payer Name").
- [ ] **Decision Path:** Shows which logic gate was triggered (Scenario A, B, or C).
- [ ] **User Attribution:** Captures the ID of the analyst who approved or overrode the AI suggestion.

---

## ğŸ—ï¸ Story 9.3: Immutable Ledger Storage (CSV-Vault)
**User Persona:** As a Systems Administrator, I want the audit logs to be stored in a "Write-Once-Read-Many" (WORM) format to prevent accidental deletion of financial history.

### ğŸ“ Description
Implement a secure file-handling wrapper for `compliance_log.csv`. The system must append new logs but prevent any "Update" or "Delete" operations through the Streamlit interface.

### âœ… Acceptance Criteria
- [ ] **Append-Only Logic:** Verified via unit tests that historical rows cannot be overwritten by the app.
- [ ] **Auto-Archiving:** Logs are automatically partitioned by Month (e.g., `audit_log_2026_01.csv`) to prevent performance degradation.
- [ ] **Access Control:** The "Clear Logs" functionality is restricted to the "Admin" role only via `st.session_state`.

---

## ğŸ—ï¸ Story 9.4: Compliance Health Check Dashboard
**User Persona:** As a CFO, I want a high-level view of our "Automation Confidence" so I can report on the reliability of our AI treasury operations.

### ğŸ“ Description
Create a "Compliance Pulse" chart that visualizes the distribution of match confidence across the entire portfolio. 

### âœ… Acceptance Criteria
- [ ] **Confidence Histogram:** A Plotly chart showing the volume of matches at 100%, 90-95%, and <80% confidence.
- [ ] **Alert System:** Visual indicator for any "High Value, Low Confidence" matches that were auto-posted (Policy Violation).
- [ ] **KPI:** Display the "STP Integrity Score" (Ratio of correct matches vs. manual reversals).



---

## ğŸš€ Technical Sub-tasks for Developers
1. **Security Layer:** Implement `backend/compliance_vault.py` with SHA-256 logic.
2. **UI Enhancement:** Refactor the "Audit Ledger" tab in `main.py` to support searchable, sortable dataframes with modal popups.
3. **Data Protection:** Implement file-locking mechanisms to prevent concurrent write errors to the audit CSV.
4. **Mock Data Expansion:** Add a `History` tab to `mock_data_maker.py` to prepopulate the ledger with 100+ "historical" hashed entries.
